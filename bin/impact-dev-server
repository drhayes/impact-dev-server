#!/usr/bin/env node

const ImpactDevServer = require('../lib/impact-dev-server');
const yargs = require('yargs');

const argv = yargs
  .usage('Start a local development server for ImpactJS.')
  .options('p', {
    alias: 'port',
    default: 8080,
    describe: 'The server port.'
  })
  .options('r', {
    alias: 'live-reload',
    describe: 'Do a live reload when game files change.',
    boolean: true
  })
  .help('h', 'Help!')
  .alias('h', 'help')
  .check(argv => {
    // Check that port is a number.
    if (!Number.isFinite(argv.p)) {
      throw Error('Port must be a number.');
    }
    return true;
  })
  .argv;

if (argv.h) {
  console.log(yargs.help());
  process.exit();
}

const server = new ImpactDevServer({
  root: argv._[0] || './',
  port: argv.p,
  reload: argv.r
});

const url = 'http://localhost:' + argv.p;
console.log('Listening on ' + url + '/ ...');
